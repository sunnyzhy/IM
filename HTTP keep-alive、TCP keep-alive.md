# HTTP keep-alive、TCP keep-alive

## HTTP keep-alive

HTTP 1.0 和 HTTP 1.1 的区别在于连接复用，在 HTTP 1.1 的请求头中会多一个 ```Connection: keep-alive```。

Chrome 浏览器对于同一个后端服务器最多有 6 个连接的限制。也就是说，无论刷新的页面同时有多少个 AJAX 请求，Chrome 只会限制这些请求最多通过 6 个 TCP 连接来完成。

举个例子，一个页面有 10 个 AJAX 请求，此时刷新页面，浏览器会限制这 10 个请求通过 6 个 TCP 连接完成，这样就会有 4 个请求复用之前的连接。这就是 HTTP 1.1 中 keep-alive 的概念。

## TCP keep-alive

TCP keep-alive 是 TCP 的保活功能，通过发送 Keep-Alive 包来探测连接的对端是否存在，主要用来检测并关闭异常连接。

浏览器和服务端之间的连接不会一直保持，连接会在以下几种情况下关闭：

1. 当浏览器关闭的时候，连接将会关闭，这属于客户端主动关闭连接的情况
2. 当浏览器长时间未操作的时候，具体表现为连接长时间未传输数据的时候，服务端也会关闭连接，这属于服务端主动关闭的情况
3. 浏览器会通过 TCP keep-alive 来检测连接，如果检测连接失效，也就是服务端无响应，也会主动关闭连接

## 心跳检测

通过发送自定义的心跳包来检测连接的有效性，一般是客户端向服务端发送心跳包。

## 区别

- **TCP keep-alive 与 HTTP keep-alive 没有任何联系，这是两个完全不同的概念**
- HTTP keep-alive 是应用层的概念，表示不同的 HTTP 请求可以复用之前的连接
- TCP keep-alive 是传输层的概念，通过发送 Keep-Alive 包判断对端是否存在
- 心跳检测是应用层的概念，通过发送自定义的心跳包来检测连接的有效性
- 通常 TCP Keep-Alive 与心跳检测只需要一个就可以了，因为它们都是用来检测连接有效性的
